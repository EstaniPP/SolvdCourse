--INSERTS--

insert into Companies (name, phone_number, email) values (‘StarBucks’, '+54-2234834688', 'starbucks@mail.com');
insert into Companies (name, phone_number, email) values (‘McDonalds’, '+54-2236721345', 'mcdonalds@mail.com');

insert into Shops (company_id, address, phone_number, email) values (1,'StarBucksShop', '+54-2234834688', 'starbucksshop@mail.com');

insert into Products (shop_id, description, size_width, size_height) values (1, 'Grey Tea', 10, 10);
insert into Products (shop_id, description, size_width, size_height) values (1, 'SmallCoffee', 10, 7);
insert into Products (shop_id, description, size_width, size_height) values (1, 'BigCoffee', 10, 13);

insert into Products_in_orders (order_id, product_id, quantity) values (1,1,1);
insert into Products_in_orders (order_id, product_id, quantity) values (2,1,3);
insert into Products_in_orders (order_id, product_id, quantity) values (1,2,4);
insert into Products_in_orders (order_id, product_id, quantity) values (1,3,6);

insert into Orders (vehicle_id, costumer_id, address_id, employee_id, price, date) values (1,1,1,1,25,'2020-05-09');
insert into Orders (vehicle_id, costumer_id, address_id, employee_id, price, date) values (1,1,1,1,25,'2020-05-10');

insert into Address (costumer_id, address, city, estate, postal_code) values (1, 'AV9 number 1344', 'Tandil', 'Buenos Aires', '7607');

insert into Costumers (first_name, last_name, email, birth_date) values ('Perez Pena', 'Estanislao', 'estanipp@gmail.com', '1997-04-29');

--DELETES--

delete from Products_in_orders where product_id in (select id from Products where description = 'Grey Tea'); 

delete from Orders where  costumer_id = 5;

delete from Companies where id = (select company_id from Shops where id = 1) 

--UPDATE--

update Orders set price = price*1.21

update Delivery_Employees set delivery_fee = delivery_fee*1.1 where (select count(*) from Orders o where Delivery_Employees.id = o.employee_id) > 5

--SELECT STATEMENT--

select * from 
	Orders o LEFT JOIN Complains ON o.id = Complains.order_id
		LEFT JOIN Addresses ON o.address_id = Address.id
		LEFT JOIN Costumers ON o.costumer_id = Costumers.id
		LEFT JOIN Costumer_phone_numbers cph ON cph.costumer_id = Costumers.id
		LEFT JOIN Products_in_orders po ON po.order_id = o.id
		LEFT JOIN Products p ON p.id = po.product_id
		LEFT JOIN Shops s ON p.shop_id = s.id
		LEFT JOIN Companies ON Companies.id = s.company_id
		LEFT JOIN Business_hours bh ON bh.shop_id = s.id
		LEFT JOIN Delivery_Employees de ON o.employee_id = de.employee_id
		LEFT JOIN Employees e ON e.id = de.employee_id
		LEFT JOIN Administrative_employees ae ON ae.employee_id = e.id
		LEFT JOIN Employees_hours eh ON eh.employee_id = e.id
		LEFT JOIN Employees_phone_numbers eph ON eph.employee_id = e.id
		LEFT JOIN Departments d ON d.id = e.department_id
		LEFT JOIN Administrative_employees ae2 ON d.ceo_id = ae2.id
		LEFT JOIN Vehicles v1 ON v1.id = o.vehicle_id
		LEFT JOIN Departments d2 ON v1.department_id = d2.id;

--HAVING QUERYS--

//If i want to know which employees delivered more than five orders
SELECT employee_id 
FROM Orders
group by employee_id 
having count(*) > 5

//Which orders has exactly five products to deliver
SELECT o.id 
FROM Orders o LEFT JOIN Products_in_orders po ON po.order_id =o.id
group by o.id 
having sum(po.quantity) = 5

//Products that have been sold in more than 10 orders and have a size_width greater than 10
SELECT p.id 
FROM Products p LEFT JOIN Products_in_orders pio ON p.id = pio.product_id
where p.size_width > 10
group by p.id
having count(*) > 10

//Companies id that have more than 50 employees
SELECT company_id 
FROM Employees
group by company_id
having count(*) > 50

//Costumers information with more addresses in 'New York'
SELECT c.*
FROM Costumers c LEFT JOIN Addresses a ON c.id = a.costumer_id
where a.city = 'New York'
group by c.id
having count(*) = (select max(mycount)
				   from (select count(*) mycount from Addresses
						 where a.city = 'New York'
						 ORDER BY costumer_id)